{% extends "templates/layout.jinja2" %}
{% block content %}
<section id="manage-products">
	<div class="page-header">
		<h1>Product Management
			 <small class="pull-right">
			  	<a href="{{'addproduct'|route_url}}" title="Add New Product to stock!" class="btn btn-primary">
			  		<i class="icon-plus icon-white"></i> Add Item
			  	</a>
			 </small>
		 </h1>
	</div> 	
	<div class="row-fluid">
		<div class="span12">&nbsp;</div>
	</div>
    {% if model != None and (model | count) > 0 %} 
	<table id="prdTable" class="table table-bordered table-striped table-condensed">
		<thead>
			<tr>
				<th><i class="icon-barcode"></i> Barcode</th>
				<th>Name</th>
				<th style="text-align:right;">MRP</th>
				<!--<th style="text-align:right;">BuyPrice</th>-->
				<th style="text-align:right;">SellPrice</th>
				<th style="text-align:right;">Discount</th>
				<th style="text-align:center;">Created On</th>
				<th style="text-align:center;">Updated On</th>
				<th>Action</th>
			</tr>
		</thead>
		<tbody>
			{% for item in model %}
				<tr class="{{'alert alert-error' if not item.Status}}">
					<td>
						{{item.Barcode}}
					</td>
					<td>
						{{item.Name}}
					</td>
					<td style="text-align:right;">
						{{item.MRP}}
					</td>
					<!--<td style="text-align:right;">
						{{item.BuyPrice}}
					</td>-->
					<td style="text-align:right;">
						{{item.SellPrice}}
					</td>
					<td style="text-align:right;">
						{{item.Discount}}
					</td>
					<td style="text-align:center;">
						{{item.CreatedOn | datetimeformat('%d-%m-%Y')}}
					</td>
					<td style="text-align:center;">
						{{item.UpdatedOn | datetimeformat('%d-%m-%Y') | d('--',true)}}
					</td>
					<td>
						<div class="btn-group">
							<button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
								Action <span class="caret"></span>
							</button>
							<ul class="dropdown-menu">
								<li>
									<a href="{{'editproduct' | route_url(pid=item.Id)}}"><i class="icon-pencil"></i> Edit</a>
								</li>
								<li>
									<a href="{{'deleteproduct' | route_url(pid=item.Id)}}"><i class="icon-trash"></i> Delete</a>
								</li>
								{% if item.Status %}
								<li>
									<a data-status="{{item.Status}}" class="pstatus" href="#" data-url="{{'markreturnproduct' | route_url(pid=item.Id)}}"> Mark Return</a>
								</li>
								{% else %}
								<li>
									<a data-status="{{item.Status}}" class="pstatus" href="#" data-url="{{'markreturnproduct' | route_url(pid=item.Id)}}"> Make Active</a>
								</li>
								{% endif %}
							</ul>
						</div>
					</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>
	{% else %}
		<div class="alert alert-info">
			No products found!
		</div>
	{% endif %}
</section>      
{% endblock %}
{% block footerscript %}
<style>
tr.alert-error td{
	background-color: #F2DEDE !important;
    border-color: #EED3D7;
    color: #B94A48;
}
</style>
<script>
	$(function(){
		//$('#prdTable').dataTable();
		$('#prdTable a.pstatus').click(function(){
			var url = $(this).data('url')
			var st = $(this).data('status')
			var tr = $(this).closest('tr')
			var that = $(this)
						
			$.post(url,{status:!(st == 'True')},function(data){
				if(data && data.status == true) {
					if(st == 'True') {
						tr.addClass('alert')
						tr.addClass('alert-error')
						that.text('Mark Active')
						that.data('status','False')
					} else {
						tr.removeClass('alert')
						tr.removeClass('alert-error')
						that.text('Mark Return')
						that.data('status','True')
					}
				}
			})
			return true
		})
	});
</script>
{% endblock %}
