{% extends "templates/layout.jinja2" %}
{% block content %}
<section id="manage-products">
	 <div class="page-header">
       <h1> {{ 'Add Purchase' if not model.Id }}
	        {{ 'Edit Purchase' if model.Id }}
		 <small class="pull-right">
		  	<a href="{{'purchases'|route_url}}" title="Back to Purchase listing!" class="btn btn-primary">
		  		<i class="icon-arrow-left icon-white"></i> Back
		  	</a>
		 </small></h1>
	</div>
	<div class="row-fluid">
		 {% if errors or renderer.errorlist() or purchaseRenderer.errorlist() -%} 
		 	<div class="alert alert-error">
		 		<strong>Please correct the errors and submit again:</strong>
		 		{{ ('<ul><li>'+ errors + '</li></ul>') | safe if errors }}
		 		{{renderer.errorlist(name=None,class='')}}
		 		{{purchaseRenderer.errorlist(name=None,class='')}}
		 	</div>
		 {%- endif %}
		 </span>
		 <div class="clear"></div>
		 <div class="span7">
		 	<div class="span12">
		 		<h3>Purchase Details</h3>
		 		<form action="{{'savepurchase'|route_url}}" method="post" class="well form-inline">
		 			<div class="control-group {{ 'error' if purchaseRenderer.is_error('PurchaseNo') }}" style="float:left;margin-right:10px;">
						{{purchaseRenderer.label('PurchaseNo','Bill No#',class='control-label')}}
						<div class="controls">
							{{purchaseRenderer.text('PurchaseNo',size=50,class='input-medium')}}
						</div>
					</div>
					<div class="control-group {{ 'error' if purchaseRenderer.is_error('SupplierId') }}" style="float:left;margin-right:10px;">
						{{purchaseRenderer.label('SupplierId','Supplier',class='control-label')}}
						<div class="controls">
							{{purchaseRenderer.select('SupplierId',suppliers,prompt='Choose a supplier',class='input-medium')}}
						</div>
					</div>
					<div class="control-group {{ 'error' if purchaseRenderer.is_error('PurchaseDate') }}">
						{{purchaseRenderer.label('PurchaseDate','Purchase Date',class='control-label')}}
						<div class="controls">
							{{purchaseRenderer.date('PurchaseDate',class='datetime input-medium')}}
						</div>
					</div>
					<div class="form-actions">
						<input type="hidden" name="pid" value="{{model.Id|d('',True)}}"/>
						<input type="submit" class="btn btn-primary" value="Save"/>
					</div>
				 </form>
		 	</div>
		 	<div class="clear"></div>
		 	<div class="span12">
		 		<h4>Purchase Line Items</h4>
		 		<div id="purchaseLineItems"></div>
		 	</div>
		 </div>
		 <div class="span4">
			<h3>Add/Edit Item</h3>
			<form class="form-inline well">
				{% import 'shared/productform.jinja2' as productForm with context %}
				{{ productForm.render(renderer) }}
				<div class="form-actions">
					<input type="button" class="btn btn-primary" value="Add"/>
					<input type="reset" name="reset" class="btn" value="Reset"/>
				</div>
			</form>
		 </div>
	</div>
</section>      
{% endblock %}
{% block footerscript %}
<script>
	$(function(){
		$('input.datetime').datepicker({ dateFormat: 'dd-mm-yy' })
	});
</script>
{% endblock %}
