{% extends "templates/layout.jinja2" %}
{% block head %}
<style>
table#tblTodayOrders tbody tr{
	cursor:pointer;
	-moz-user-select: none;
	-webkit-user-select: none;
}
table#tblTodayOrders tbody tr td{
	-moz-user-select: none;
	-webkit-user-select: none;
}
table#tblTodayOrders tbody tr.active td{
	background-color:lightyellow !important;
}
.vsplitbar {
	width: 5px;
	background: #aaa;
	height:100%;
}
</style>
{% endblock %}
{% block content %}
<section id="sales-page">
	 <div class="page-header">
      <h1>Sales
      	<div class="span8 pull-right"> 
      		<a id="new-order" class="btn btn-primary"><i class="icon-file icon-white"></i> New (F3)</a>
      		<a id="cancel-order" class="btn btn-warning"><i class="icon-remove icon-white"></i> Cancel (F4)</a>
      		<a id="checkout-order" class="btn btn-success"><i class="icon-shopping-cart icon-white"></i> Checkout (F5)</a>
      		<a id="print-order" class="btn btn-primary"><i class="icon-print icon-white"></i> Print (F11)</a>
      		<a id="preview-order" class="btn btn-primary"><i class="icon-eye-open icon-white"></i> Preview (F12)</a>
      	</div>
      </h1>
     </div> 
      <div class="row-fluid" id="splitterContainer">
		<div class="span3" id="orderListDiv">
			<h3>Today Orders
				<div class="pull-right">
					<a id="refresh-orders" class="btn btn-mini btn-info">
						<i class="icon-refresh icon-white"></i> Refresh
					</a>
				</div>
			</h3>
			<div style="height:510px;overflow:auto;">
			<table class="table table-striped table-bordered table-condensed" id="tblTodayOrders">
				<thead>
					<tr>
						<th>Order No#</th>
						<th>Time</th>
						<th>Amount</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			</div>
			<div class="span11">
				<h3>Special Items</h3>
				<table class="table table-striped table-bordered table-condensed">
					<tr><td>Plastic Bag `1</td>
					<td class="tcenter"><button class="btn btn-mini btn-info">Add</button></td></tr>
					<tr><td>Plastic Bag `2</td>
					<td class="tcenter"><button class="btn btn-mini btn-info">Add</button></td></tr>
					<tr><td>Plastic Bag `3</td>
					<td class="tcenter"><button class="btn btn-mini btn-info">Add</button></td></tr>
					<tr><td>Idly Paste</td>
					<td class="tcenter"><button class="btn btn-mini btn-info">Add</button></td></tr>
				</table>
			</div>
		</div>
		<div class="span9" id="rightPane" style="border-left:1px solid #ccc;padding-left:10px;">
			<div class="span12" id="orderDetailsDiv">
		  		<div class="span6">
		  			<strong>Order No#</strong> <span id="orderNumber">0</span>
		  		</div>
		  		<div class="span6" style="text-align:right">
		  			<strong>Order Date:</strong> <span id="orderDate"></span>
		  		</div>
		  		<div class="clear"/>
		  		<div class="span12">
		  			<strong>Customer Name:</strong> <span id="customerName"></span>
		  		</div>
			</div>
			<div class="span12" id="statusMessage">
			</div>
			<table class="table">
				<thead>
					<tr>
						<th>Barcode:</th>
						<th>Item Name:</th>
						<th>Quantity:</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><input type="text" name="barcode"/></td>
						<td><input type="text" name="itemName"/></td>
						<td><input type="text" name="quantity" value="1"/></td>
						<td><a id="add-item" class="btn btn-primary"><i class="icon-plus icon-white"></i> Add </a></td>
					</tr>
				</tbody>
			</table>
			<div style="height:450px;overflow-y:auto;overflow-x:auto;">
				<table class="table table-striped table-bordered table-condensed" id="tblOrderLineItems">
					<thead>
						<tr>
							<th></th>
							<!--<th>Sl.No#</th>-->
							<th>Barcode</th>
							<th>Item Name</th>
							<th style="text-align:right;">MRP</th>
							<th style="text-align:right;">Price</th>
							<th style="text-align:right;">Discount</th>
							<th style="text-align:right;">Quantity</th>
							<th style="text-align:right;">Gross</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>
			</div>
			<table class="table" id="tblSalesFooter">
				<tbody>
					<tr>
						<td>Total Items/Quantity: <span id="totalItemsQuantity">0/0</span></td>
						<td></td>
						<td><h3>Total Amount:</h3></td>
						<td width="150px" style="text-align:right;padding-right:50px;color:red;"><h1 id="totalAmount">0.0</h1></td>
					</tr>
					<tr>
						<td>Savings: <b><span id="savingsAmount">0.0</span></b></td>
						<td></td>
						<td><h3>Paid Amount:</h3></td>
						<td style="text-align:right;padding-right:50px"><h3 id="paidAmount">0.0</h3></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
						<td><h3 id="lblBalanceAmount">Balance/Change Amount:</h3></td>
						<td style="text-align:right;padding-right:50px"><h3 id="balanceAmount">0.0</h3></td>
					</tr>
				</tbody>
			</table>
		</div>
      </div>
</section>      
<section>
	<div class="modal fade" id="selectItemModal">
	  <div class="modal-header">
		<button class="close" data-dismiss="modal">×</button>
		<h3>Multiple Items found</h3>
	  </div>
	  <div class="modal-body">
		<table class="table table-striped table-bordered table-condensed" id="tblSelectItem">
			<thead>
				<th>Barcode</th>
				<th>Item Name</th>
				<th>MRP</th>
				<th>Price</th>
				<th>Added On</th>
				<th>Action</th>
			</thead>
			<tbody>
			</tbody>
		</table>
	  </div>
	  <div class="modal-footer">
		<a href="#" data-dismiss="modal" class="btn">Close</a>
	  </div>
	</div>
	<div class="modal fade" id="checkoutOrderModel">
	  <div class="modal-header">
		<button class="close" data-dismiss="modal">×</button>
		<h3>Checkout</h3>
	  </div>
	  <div class="modal-body">
		<table class="table table-striped">
			<tbody>				
			</tbody>
		</table>
	  </div>
	  <div class="modal-footer">
		<a href="#" data-dismiss="modal" class="btn"><i class="icon-remove"></i> Close</a>
		<a href="#" class="btn btn-primary" id="btnPayOrder"> $ Pay</a>		
	  </div>
	</div>
</section>
<section id="templates" style="display:none">
	<script type="text/template" id="tpl-chkoutorder">
		<tr>
			<th>Order No#</th>
			<td>
				<b><%= item.get('orderno')%></b>
			</td>
		</tr>
		<tr>
			<th>Total Amount:</th>
			<td>
				<h3 style="color:red"><%= item.get('orderamount').toFixed(2)%></h3>
			</td>
		</tr>
		<tr>
			<th>Customer:</th>
			<td>
				<input type="text" class="typeahead" data-provide="typeahead" name="customername" placeholder="Enter customer name or mobile number..."  value="<%=item.get('customername')||''%>" required />
				<input type="hidden" name="customerid" value="<%=item.get('customerid')||''%>" />
				<div class="controls">
					<fieldset>
						<label class="radio inline">
							<input type="radio" name="searchfield" value="name" checked="checked"/> Name
						</label>
						<label class="radio inline">
							<input type="radio" name="searchfield" value="mobile"/> Mobile
						</label>
						<label class="radio inline">
							<input type="radio" name="searchfield" value="customerno"/> Customer No
						</label>
					</fieldset>
				</div>
			</td>
		</tr>
		<tr>
			<th>Payment Type</th>
			<td>
				<select class="dropdown" name="paymenttype">
					<option>Cash</option>
					<option>Credit</option>
					<option>Card</option>
					<option>Cheque</option>
				</select>
			</td>
		</tr>
		<tr>
			<th>Paid Amount:</th>
			<td>
				<input type="number" name="paidamount" placeholder="<%=item.get('orderamount').toFixed(2)%>" value="<%=item.get('balanceamount').toFixed(2)%>" required autofocus="autofocus"/>
			</td>
		</tr>
	</script>
	<script type="text/template" id="tpl-selectitem">
		<% 	var cnt=0;
			_.each(items, function(item) { %>
		<tr>
			<td><%= item.Barcode %></td>
			<td><%= item.Name %></td>
			<td class="tright"><%= item.MRP.toFixed(2) %></td>
			<td class="tright"><%= item.SellPrice.toFixed(2) %></td>
			<td><%= item.CreatedOn %></td>
			<td class="tcenter"><button class="btn btn-mini btn-info" data-id="<%= cnt++ %>">Select</button></td>
		</tr>
		<% }); %>
	</script>
	<script type="text/template" id="tpl-lineitem">
		<tr data-id="<%= item.get('id') %>">
			<td class="del"><a data-slno="<%= item.get('slno') %>" href="#" class="del-lineitem"><i class="icon-trash"></i></a></td>
			<!--<td class="sl"><%= item.get('slno') %></td>-->
			<td class="b"><%= item.get('barcode') %></td>
			<td class="n"><%= item.get('name') %></td>
			<td class="m tright"><%= item.get('mrp') %></td>
			<td class="p tright"><%= item.get('price') %></td>
			<td class="d tright"><%= item.get('discount') %></td>
			<td class="q tright"><%= item.get('quantity') %></td>
			<td class="st tright tbold"><%= item.get('subtotal').toFixed(2) %></td>
		</tr>
	</script>
	<script type="text/template" id="tpl-todayorderitem">
		<tr data-orderid="<%= item.get('orderid') %>" title="Click to edit!">
			<td class="o tbold"><%= item.get('orderno') %></td>
			<td class="c"><%= $.format.date(ToLocalDate(item.get('orderdate')),'dd/MM h:mm a') %></td>
			<td class="a tright tbold"><%= item.get('orderamount').toFixed(2) %></td>
		</tr>
	</script>	
</section>
{% endblock content %}
{% block footerscript %}
<script src="{{request.static_url('viper:static/js/salesapp/salesmodels.js')}}"></script>
<script src="{{request.static_url('viper:static/js/salesapp/salesapp.js')}}"></script>
<script>
	$(function(){
		$('input[name=barcode]').focus()
	});
	function ToLocalDate (inDate) {
		if(_.isString(inDate))
			inDate = new Date(inDate);
	    var date = new Date();
    	date.setTime(inDate.valueOf() - 60000 * inDate.getTimezoneOffset());
	    return date;
	}	
</script>

{% endblock %}


